<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Danh sách câu hỏi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans bg-gray-100">
  <!-- Header -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="flex items-center gap-2 select-none">
        <img src="Img/Gen/Logo.jpg" class="w-10 h-10 rounded-full" alt="Logo" />
        <span class="text-2xl font-bold text-blue-700">THI CHỨNG CHỈ XÂY DỰNG</span>
      </a>

      <nav class="hidden md:flex gap-6 text-gray-700 font-medium">
        <a href="index.html#dmch" class="hover:text-blue-600">Danh mục câu hỏi</a>
        <a href="index.html#thithu" class="hover:text-blue-600">Thi thử</a>
        <a href="index.html#tintuc" class="hover:text-blue-600">Tin tức</a>
        <a href="index.html#hotro" class="hover:text-blue-600">Hỗ trợ hồ sơ thi</a>
        <a href="index.html#dangnhap" class="hover:text-blue-600">Đăng nhập</a>
      </nav>
    </div>
  </header>

  <div class="max-w-7xl mx-auto mt-6 px-4 grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Main: Danh sách câu hỏi -->
    <main class="lg:col-span-3 space-y-6 bg-white p-6 rounded-xl shadow">
      <h1 class="text-2xl font-bold text-gray-800">Danh sách câu hỏi</h1>
      <div id="quiz">Đang tải dữ liệu...</div>

      <!-- Nút phân trang trên -->
      <div id="pagination-top" class="flex justify-between items-center mt-4"></div>
      <!-- Nút phân trang dưới -->
      <div id="pagination-bottom" class="flex justify-between items-center mt-4"></div>
    </main>

    <!-- Sidebar -->
    <aside class="lg:col-span-1 space-y-6">
      <div class="bg-white shadow rounded-lg p-4">
        <h3 class="font-bold text-gray-700 mb-2">Tài khoản</h3>
        <p class="text-gray-600">Bạn chưa đăng nhập</p>
        <a href="#dangnhap" class="text-blue-600 text-sm hover:underline">Đăng nhập ngay</a>
      </div>

      <div class="bg-white shadow rounded-lg p-4">
        <h3 class="font-bold text-gray-700 mb-2">Một số bài thi</h3>
        <ul class="list-disc list-inside text-gray-600 space-y-1">
          <li>Bài thi Pháp luật chung</li>
          <li>Bài thi Giám sát XD</li>
          <li>Bài thi Thiết kế điện</li>
          <li>Bài thi Hạ tầng kỹ thuật</li>
        </ul>
      </div>

      <div class="bg-white shadow rounded-lg p-4">
        <h3 class="font-bold text-gray-700 mb-2">Tin tức mới</h3>
        <ul id="tintuc-list" class="space-y-2 text-sm text-gray-600"></ul>
      </div>

      <div class="bg-white shadow rounded-lg p-4">
        <h3 class="font-bold text-gray-700 mb-2">Hỗ trợ hồ sơ thi</h3>
        <p class="text-gray-600 text-sm">Tư vấn thủ tục, biểu mẫu và cách nộp hồ sơ trực tuyến.</p>
      </div>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="mt-10 bg-gray-800 text-gray-200 py-6">
    <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-3">
      <p>© 2025 Thi Chứng Chỉ XD. All rights reserved.</p>
      <nav class="space-x-4 text-sm">
        <a href="#" class="hover:underline">Liên hệ</a>
        <a href="#" class="hover:underline">Chính sách</a>
      </nav>
    </div>
  </footer>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC9FpbD2UQ9k-6V6J2valKvVEXiL-r42tI",
      authDomain: "thi-cchn-xd.firebaseapp.com",
      projectId: "thi-cchn-xd",
      storageBucket: "thi-cchn-xd.appspot.com",
      messagingSenderId: "919472549520",
      appId: "1:919472549520:web:994dc0c28f077b4d4cb215",
      measurementId: "G-V54RWTK57J"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    async function loadQuestions() {
      const hang = getParam("hang");
      const linhvuc = getParam("linhvuc");
      const loai = getParam("loai");
      const s = parseInt(getParam("s")) || 1;
      const e = parseInt(getParam("e")) || 20;

      let conditions = [];
      if (hang) conditions.push(where("MucDo", "==", hang));
      if (linhvuc) conditions.push(where("LinhVuc", "==", linhvuc));
      if (loai) conditions.push(where("LoaiCauHoi", "==", loai));

      const q = query(collection(db, "CauHoi"), ...conditions);
      const snapshot = await getDocs(q);

      let questions = [];
      snapshot.forEach(doc => questions.push(doc.data()));

      questions.sort((a, b) => (a.SoThuTu || 0) - (b.SoThuTu || 0));

      const selected = questions.filter(q => q.SoThuTu >= s && q.SoThuTu <= e);

      document.getElementById("quiz").innerHTML = selected.map(q => `
        <div class="border-b pb-4 mb-4">
          <h3 class="font-bold text-lg">${q.SoThuTu || ""}. ${q.NoiDung}</h3>
          <ul class="list-disc ml-6 mt-2 space-y-1">
            <li>A. ${q.PhuongAnA}</li>
            <li>B. ${q.PhuongAnB}</li>
            <li>C. ${q.PhuongAnC}</li>
            <li>D. ${q.PhuongAnD}</li>
          </ul>
          <p class="mt-2 text-green-700"><b>Đáp án đúng:</b> ${q.DapAn?.toUpperCase() || "?"}</p>
          <p class="text-gray-500 text-sm"><i>Mức độ:</i> ${q.MucDo || ""}</p>
        </div>
      `).join("") || "❌ Không tìm thấy câu hỏi nào!";

      // render pagination
      renderPagination(s, e, questions.length, hang, linhvuc, loai);
    }

    function renderPagination(s, e, total, hang, linhvuc, loai) {
      const step = e - s + 1;
      const prevS = Math.max(1, s - step);
      const prevE = s - 1;
      const nextS = e + 1;
      const nextE = e + step;

      const params = (s, e) => 
        `cauhoi.html?hang=${hang || ""}&linhvuc=${linhvuc || ""}&loai=${loai || ""}&s=${s}&e=${e}`;

      let prevBtn = s > 1 ? `<a href="${params(prevS, prevE)}" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">⬅️ Prev Page</a>` : "";
      let nextBtn = e < total ? `<a href="${params(nextS, nextE)}" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Next Page ➡️</a>` : "";

      document.getElementById("pagination-top").innerHTML = prevBtn + nextBtn;
      document.getElementById("pagination-bottom").innerHTML = prevBtn + nextBtn;
    }

    loadQuestions();
  </script>
</body>
</html>
